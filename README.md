# Техническое задание

В качестве клиента используется консольное приложение.
 <br>
 <br>
 <br>
## Обмен личными и групповыми сообщениями в реальном времени без pull запросов на сервер (signalr).
Для обмена сообщениями используется SignalR:
1. Пользователь может отправить личное сообщение другому пользователю
2. Или групповое сообщение в одну из групп
   
Обработка сообщений реализована в классе `ChatHub.cs`.
 <br>
 <br>
 <br>
## Возможность редактировать и удалять сообщения pull запросов
Редактирование и удаление сообщений реализовано через HTTP API (pull-запросы):
- `PUT /api/messages/{id}` — редактирует содержимое сообщения
- `DELETE /api/messages/{id}` — помечает сообщение как удалённое (soft delete)

Эти запросы можно протестировать через встроенный Swagger-интерфейс по адресу: `http://localhost:5000/swagger`
Удалённые сообщения не отображаются в истории, но физически остаются в базе (`IsDeleted = 1`).
 <br>
 <br>
 <br>
## Возможность контроля на сервере онлайн/офлайн статусов пользователей (signalr, redis)
Сервер отслеживает подключение и отключение пользователей через SignalR и сохраняет их статус в Redis:
- При подключении пользователя его `userId` добавляется в Redis-множество `online_users`
- При отключении — удаляется из этого множества

Для просмотра списка онлайн-пользователей реализан HTTP-метод: `GET /api/messages/online`.
 <br>
 <br>
 <br>
## Возможность восстановления истории переписки после перезапуска клиентов или сервера (mssql)
Все сообщения сохраняются в базе данных MSSQL (LocalDB).
- После перезапуска клиента или сервера история переписки автоматически загружается из таблицы `Messages`.
- Структура таблиц описана в файле `Database/init.sql`.
- Перед запуском убедитесь, что база данных создана (`MessengerDb`) и применён скрипт из файла.
- Строка подключения по умолчанию: `Server=(localdb)\\MSSQLLocalDB;Database=MessengerDb;Trusted_Connection=True;`
- История загружается в клиенте методом `LoadHistory` при указании собеседника.
 <br>
 <br>

## Уведомление пользователя по электронной почте, если сообщение не прочитано более 5 минут и пользователь оффлайн (background)
Фоновый сервис `NotificationBackgroundService` каждую минуту проверяет базу данных и Redis:

Если сообщение:
1. Не прочитано (`IsRead = 0`)
2. Отправлено более 5 минут назад
3. Получатель оффлайн

Тогда отправляется уведомление (мок-отправка на Console). Сообщение помечается как уведомлённое (`IsNotified = 1`).

Физическая отправка почты эмулируется через `MockEmailSender`, который пишет информацию в консоль. 
